# 系统架构设计

## 整体架构
Online Judge 采用微服务架构，分为前端、后端和基础设施层。

### 架构图

[用户] --> [前端 (Vue3)] --> [Nginx (负载均衡)]
|
v
[API 网关] --> [题目服务] --> [MySQL (题目数据)]
--> [判题服务] --> [Docker 沙箱]
--> [用户服务] --> [MySQL (用户信息)]
--> [消息队列 (RabbitMQ)] --> [异步任务]
--> [搜索服务 (Elasticsearch)] --> [题目搜索]
--> [定时任务 (XXL-JOB)] --> [清理任务]


## 微服务划分
1. **题目服务**:
    - 管理题目（增删改查）。
    - 提供题目列表和详情 API。
2. **判题服务**:
    - 运行用户代码（Docker 沙箱）。
    - 异步处理判题任务（通过 RabbitMQ）。
3. **用户服务**:
    - 管理用户和权限。
    - 集成阿里云短信服务（发送验证码）。
4. **搜索服务**:
    - 使用 Elasticsearch 实现题目搜索（支持分词）。
5. **定时任务服务**:
    - 使用 XXL-JOB 定时清理过期数据（TTL 机制）。

## 技术选型
- **服务注册与发现**: Nacos（服务注册、配置中心）。
- **消息队列**: RabbitMQ（异步判题、通知）。
- **日志系统**: ELK（Elasticsearch + Logstash + Kibana）。
- **分布式部署**: 阿里云 ECS + Docker。

## 设计原则
- **高内聚低耦合**: 各微服务独立部署，功能解耦。
- **异步处理**: 判题任务通过 RabbitMQ 异步执行。
- **可扩展性**: 新增语言支持只需扩展判题服务。